<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Srdiop</title>
    <base href="/" />
    <link rel="stylesheet" href="css/bootstrap/bootstrap.min.css" />
    <link rel="stylesheet" href="css/app.css" />
    <link rel="icon" type="image/png" href="5.png" />
    <link href="BlazorPortfolio.styles.css" rel="stylesheet" />
    <link href="manifest.webmanifest" rel="manifest" />
    <link rel="icon" type="image/png" sizes="32x32" href="5.png">
    <link rel="icon" type="image/png" sizes="16x16" href="5.png">
    <link rel="apple-touch-icon" href="5.png">
    <!--<link rel="apple-touch-icon" sizes="512x512" href="icon-512.png" />
    <link rel="apple-touch-icon" sizes="192x192" href="icon-192.png" />-->
    <!-- Radzen CSS -->
    <link href="_content/Radzen.Blazor/css/default.css" rel="stylesheet" />
    <link rel="stylesheet" href="_content/Radzen.Blazor/css/default-base.css">
    <link href="_content/Radzen.Blazor/css/material-base.css" rel="stylesheet" />

    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet" />

</head>

<body>
    <div id="app">
        <svg class="loading-progress">
            <circle r="40%" cx="50%" cy="50%" />
            <circle r="40%" cx="50%" cy="50%" />
        </svg>
        <div class="loading-progress-text"></div>
    </div>

    <div id="blazor-error-ui">
        An unhandled error has occurred.
        <a href="" class="reload">Reload</a>
        <a class="dismiss">ðŸ—™</a>
    </div>
    <script src="_framework/blazor.webassembly.js"></script>
    <script>navigator.serviceWorker.register('service-worker.js');</script>
    <!-- Radzen JS -->
    <script src="_content/Radzen.Blazor/Radzen.Blazor.js"></script>

    <script>
        window.getWindowWidth = function () {
            return window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
        };
    </script>

    <script>
        window.downloadFile = (url, filename) => {
            const a = document.createElement('a');
            a.href = url;
            a.setAttribute('download', filename || '');
            document.body.appendChild(a);
            a.click();
            a.remove();
        };
    </script>

    <script>
        window.PortfolioNav = (function () {
            let observer, links = [];

            function setActive(id) {
                links.forEach(a => a.classList.toggle('active', a.dataset.target === id));
            }

            // Accepte soit un tableau, soit des arguments multiples
            function initScrollSpy(/* ...ids */) {
                const args = Array.from(arguments);
                const ids = Array.isArray(args[0]) ? args[0] : args;

                links = Array.from(document.querySelectorAll('.top-nav .nav-pill'));

                const options = { root: null, rootMargin: "0px 0px -60% 0px", threshold: 0.1 };
                observer = new IntersectionObserver((entries) => {
                    entries.forEach(e => { if (e.isIntersecting) setActive(e.target.id); });
                }, options);

                ids.forEach(id => {
                    const el = document.getElementById(id);
                    if (el) observer.observe(el);
                });

                links.forEach(a => {
                    a.addEventListener('click', () => setActive(a.dataset.target));
                });
            }

            return { initScrollSpy };
        })();
    </script>

    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>

    <script>
        // La fonction accepte maintenant les paramÃ¨tres d'EmailJS en entrÃ©e
        // Doit Ãªtre global et chargÃ© AVANT lâ€™appel depuis Blazor
        window.sendEmail = async function (data, publicKey, serviceId, templateId) {
            // LOGS utiles en dev (supprime-les ensuite)
            console.log("EmailJS params:", { publicKey, serviceId, templateId, data });

            if (!publicKey) throw new Error("publicKey is empty");
            if (!serviceId) throw new Error("serviceId is empty");
            if (!templateId) throw new Error("templateId is empty");

            // IMPORTANT : EmailJS v4 -> init avec objet { publicKey: ... }
            emailjs.init({ publicKey: publicKey });

            return new Promise((resolve, reject) => {
                emailjs.send(serviceId, templateId, {
                    title: data.subject,  // <-- Le sujet de votre formulaire Blazor devient la variable {{title}}
                    name: data.name,    // <-- Le nom de votre formulaire Blazor devient la variable {{name}}
                    email: data.email,    // <-- L'email de votre formulaire Blazor devient la variable {{email}}
                    message: data.message // <-- Le message de votre formulaire Blazor devient la variable {{message}}
                }).then(function (response) {
                    console.log('SUCCESS!', response.status, response.text);
                    resolve(true); // Indique le succÃ¨s
                }, function (error) {
                    console.log('FAILED...', error);
                    reject(error); // Indique l'Ã©chec
                });
            });
        };
    </script>

</body>

</html>
